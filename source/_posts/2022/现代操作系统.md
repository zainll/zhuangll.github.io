---
title: 现代操作系统
date: 2022-07-15 00:47:53
updated: 2022-07-15 00:53:53
categories: 
    - tool
tags: 
    - Computer Science
    - Another Tag
---

[toc]

现代操作系统

<!--more-->

## 第1章 绪论

体系结构(指令集、存储组织、 I/0和总线结构)
操作系统的主要任务是记录哪个程序在使用什么资源，对资源请求进行分配、评估使用代价，并且为不同的程序和用户调解互相冲突的资沥请求。
资源管理包括两种不同方式实现多路复用(共享)资源：在时间上复用和在空间上复用
纸带程序-批处理程序-多道程序-分时系统
UNIX有两个主要的版本，即AT&T System V和加州大学伯克利分校的BSD(Berkeley Software 
Distribution)。UNIX的标准，称作POSJX, MS-DOS-Windows95
处理器：程序计数器(PC)、堆栈指针、程序状态字(PSW)：包含了条件码位(由比较指令设置)、CPU优先级、换式(用户态或内核态)，以及各种其他控制位

从操作系统中获得服务，用户程序必须使用 系统调用 (sys call)以陷入内核井调用操作系统。 TRAP 指令把用户态切换成内核态，井启用操作系统

虚拟内存机制:运行大于物理内存的程序，将程序放在磁盘上，而将主存作为缓存，用来保存最频繁使用的部
分程序。这种机制需要快速地映像内存地址，以便把程序生成的地址转换为有关字节在RAM 中的物理地址。这种映像由CPU 中的 个称为存储器管理单元 Memory Management Unit, MMU 的部件来完成
I/O设备一般包括两个部分：设备控制器和设备本身
启动计算机:基本输入输出系统((Basic Input Output System, BIOS)的程序。BIOS 内有底层l/0软件，包括读键盘、写屏幕、进行磁盘I/O 以及其他过程

操作系统概念：进程
系统管理器授权每个进程使用一个给定的 UID(User IDentification)。每个被启动的进程都有启动该进程的用户UID 。子进程拥有与父进程一样的UID。用户可以是某个组的成员，每个组也有GID(Group IDentificalion)。UNIX中，有一个UID称为超级用户 (superuser) 或者Windows 中的管理员 (administrator)。
操作系统具有两种功能：为用户程序提供抽象和管理计箕机资源

![20220718223909](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220718223909.png)

fork调用返回一个值，在子进程中该值为零，井且在父进程中等于子进程的进程标识符(Process IDeotifier, PID)
父进程执行waitpid 系统调用，它只是等待，直至子进程终止子进程必须执行用户的命令。通过使用execve 系统调用可以实现
![20220718232209](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220718232209.png)



虚拟机：KVM(针对Linux 内核)、VirtualBox、Hyper-V;模拟器,二进制翻译

C语言
![20220718232859](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220718232859.png)


操作系统有两种观点:资源管理观点和扩展的机器观点。在资源管理观点中，操作系统的任务是有效地管理系统的各个部分。在扩展的机器观点中，系统的任务是为用 提供比实际机器更便干运用的抽象。这些抽象包括进程、地址空间以及文件。
操作系统构建基本概念是进程、存储管理、I/O管理、文件管理和安全

<br>

## 第2章 进程与线程

### 2.1 进程
&ensp;进程模型：包括程序计数器、寄存器和变量的当前值。
&ensp;进程创建4种事件：系统初始化、程序执行创建进程的系统调用、用户请求创建新进程、批处理作业的初始化。
&ensp;Unix系统创建进程fork，系统调用创建一个与调用进程相同的副本。父进程与子进程有相同的内存映像。子进程执行execve或类似系统调用，以修改器内存映像并运行一个新程序。Win32中CreateProcess
&ensp;进程退出：正常退出、出错退出、严重错误和被其他进程杀死。Unix调用exit，Windows中ExitProcess。
&ensp;进程层次，Unix中进程和他所有子进程组成一个进程组。
&ensp;进程状态：运行态、就绪态、阻塞态，终止；进程调度。
![20220720005759](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220720005759.png)
&ensp;进程表
![20220720010310](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220720010310.png)
&ensp;I/O类关联的是中断向量(interrup vector)的位置(靠近内存底部的固定区域)。

### 2.2 线程

&ensp;线程：创建开销小、共享进程内存、切换开销小。线程有一样地址空间。
&ensp;每个计算都有一个被保存的状态，存在一个会发生且使得相关状态发生改变的事件集合，称为有限状态机。
![20220720012833](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220720012833.png)
&ensp;线程创建 thread_create，线程退出thread_exit，等待线程退出 thread_join
&ensp;POSIS线程pthread
![20220720013227](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220720013227.png)
&ensp;有两种主要的方法实现线程包：在用户空间 中和在内核中
![20220720231701](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220720231701.png)


### 2.3 进程间通信IPC

&ensp;竞争条件：两个或多个进程读写某些共享数据，而最后的结果取决于进程运行的精确时序。共享内存进行访问的程序片段称作临界区域。
使用互斥：屏蔽中断、锁变量、严格轮换、Peterson解法、TSL测试并加锁
&ensp;信号量：down和up，对信号量down橾作，则是检查其值是否大于0，若该值大千0, 则将其值减1 (即用掉一个保存的唤醒信号)井继续，若该值为0, 则进程将睡眠，而且此时down操作井未结束。up操作对信号量的值增1
&ensp;互斥量：处干两态之一的变量：解锁和加锁。快速用户区互斥量futex。一个futex 包含两个部分一个内核服务和一个用户库
&ensp;消息传递，进程间通信方法：send和receive


### 2.4 调度Scheduler

&ensp;1.进程行为：CPU密集型进程(计算密集型)和I/O密集型进程
&ensp;2.进程调度时机：1)创建新进程时调度父进程或子进程 2)进程退出时 3)进程阻塞在I/O和信号量上时 4)I/O中断时
&ensp;3.调度算法：非抢占式和抢占式
&ensp;4.三种运行环境：批处理、交互式和实时,批处理-非抢占式，交互式-抢占式，。大型计算中心关心三个指标：吞吐量、周转时间和CPU利用率。交互系统最小响应时间。  
&ensp;5.批处理系统调度算法：1)先来先服务 2)最短作业优先 3)最短剩余时间优先
&ensp;6.交互式系统调度算法：1)轮转调度 轮询 时间片 2)优先级调度 3)多级队列 4)最短进程优先 5)公平分享调度
&ensp;7.实时系统调度：硬实时和软实时

&ensp;8.策略与机制

&ensp;9.线程调度：用户级线程和内核级线程之间的差别在于性能 用户级线程的线程切换需要少址的机器指令，而内核级线程垢要完整的上下文切换，修改内存映像，使亦速缓存失效，导致了若干数杂级的延迟


&ensp;功耗管理、虚拟化、云计算和安全问题成为了新的热点主题。

### 2.5 小结

&ensp;隐藏中断的影响，操作系统提供了 个井行执行串行进程的概念模型。进程可以动态地创建和终止、每个进程都有自己的地址空间。
&ensp;线程被独立调度并且有独立的栈，但是在一个进程中的所有线程共享一个地址空间。线程可以在用户态实现，也可以在内核态实现。
&ensp;进程之间通过进程间通信原语来交换信息，如信号众、管程和消息。进程可以处在运行、就绪或阻塞状态



<br>

## 第3章 内存管理

&ensp;分层存储器体系。存储管理器：操作系统种管理分层存储体系的部分。
&ensp;操作系统作为库实现的常见例子如流行的e-Cos操作系统。

### 3.1 存储抽象：地址空间
&ensp;地址空间一个进程可用于寻址内存的一套地址集合
&ensp;交换技术：空闲进程存到存储磁盘上，运行进程存储到物理内存。

&ensp;虚拟内存：每个程序用于自己的地址空间，空间分割位多个块，每块位一页或页面。页被映射到物理内存，运行程序时不是所有页都必须在内存中，程序引用不在物理内存中的地址空间时，操作系统将缺失部分装入到物理内存。
&ensp;内存管理单元MMU：把虚拟地址映射到物理内存地址。
&ensp;页表：虚拟地址：虚拟页号和偏移量
&ensp;保护位：三位读、写、可执行。页面使用情况：修改位和访问位。禁止高速缓存位。
&ensp;TLB(转换检测缓冲区)：，将虚拟地址直接映射到物理地址。TLB硬件实现和软件管理，当一个页面访问在内存中而不在TLB中时，将产生软失效；当页面本身不在内存中(当然也不在TLB)时，将产生硬失效。
&ensp;多级页表

&ensp;页表置换算法：最优页面置换算法、最近未使用页面置换算法、先进先出页面置换算法、**最近最少使用页面置换算法LRU**
&ensp;PDP-11 指令和数据设置分离的地址空间，分别称为I空间和D空间。进程表有两个指针：一个指向I空间页表，一个指向D空间页表。共享页面
&ensp;共享库 Windows中DLL，运行时共享，编译时共享：使用相对地址
```sh
# unix  链接当前目录下的所有的.o(目标)文件，井扫描两个库：/usr/lib/libc.a和/usr/lib/libm.a 。
Id•.o -le -Im 
```
&ensp;分页守护进程。分布式共享内存

&ensp;操作系统在四个阶段处理分页相关工作：进程创建时，进程执行时，缺页中断时和进程终止时。



## 第4章 文件系统fs

### 4.1 文件和目录

&ensp;MS-Dos Windows FAT16->FAT32->NTFS  linux ext3
&ensp;目录(directory)是管理文件系统结构的系统文件
&ensp;文件访问：顺序访问与随机访问
&ensp;文件属性
![20220729231922](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220729231922.png)

&ensp;文件操作：create、delete、open、close、read、write、append、seek、get attributes、set attributes、rename
&ensp;目录：根目录
目录操作：create、delete、opendir、closedir、readdir、rename、link、unlink

### 4.2 文件系统实现

&ensp;磁盘的0号扇区称为主引导记录(Master Boot Record MBR).在MBR结尾是分区表,给出每个分区的起始和结束地址。计算机引导时，BIOS读人并执行MBR，MBR读入他的第一个块是引导块。
&ensp;文件系统本身时一个有向无环图(DAG)。目录与该共享文件的联系称为链接(link)
&ensp;日志结构文件系统(Log-structured File System LFS)
&ensp;虚拟文件系统VFS  网络文件系统NFS

<br>

## 第5章 输入/输出 I/O

&ensp;I/O设备：块设备和字符设备。I/O设备控制器和设备本身。
&ensp;CPU如何与设备的控制寄存器和数据缓冲区进行通信？
&emsp;第一种方法，每个控制寄存器被分配一个I/O端口(I/O port)号。所有I/O端口形成I/O端口空间(I/O port space)，普通用户不可访问。
```sh
# I/O 指令
IN REG, PORT
OUT PORT, REG
```
&emsp;第二种方法：将所有控制器映射到内存空间中，每个控制器被分配唯一的一个内存地址，称为内存映射I/O。内存映射不运行缓存。优点：1)C语言可编写驱动，访问控制器寄存器 2)隔离地址空间->阻止用户进程I/O操作 

&ensp;直接存储器存取(DMA)
![20220802000949](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/20220802000949.png)

&ensp;中断信号使CPU停止当前正在做的工作井且开始做其他的事情。地址线上的数字被用做指向中断向量(interrupt vector)的表格的索引，以便读取一个新的程序计数器。
&ensp;将机器留在一个明确状态的中断称为精确中断
- PC程序计数器保存在一个已知的地方
- PC所指向的指令之前的所有指令已经完全执行
- PC所指向的指令之后的所有指令都没有执行
- PC所指向的指令的执行状态已知的
&ensp;不满足这些要求的中断称为不精确中断

    